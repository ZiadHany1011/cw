const sqlite3 = require('sqlite3');
const db = new sqlite3.Database('bitebuilder.db');

// Table creation queries
const createUserTable = `
CREATE TABLE IF NOT EXISTS USER (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    EMAIL TEXT UNIQUE NOT NULL,
    PASSWORD TEXT NOT NULL,
    ISADMIN INT
)`;

const createSandwichTable = `
CREATE TABLE IF NOT EXISTS SANDWICH (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    DESCRIPTION TEXT NOT NULL,
    PRICE REAL NOT NULL,
    STOCK INT NOT NULL,
    USER_ID INT,
    FOREIGN KEY (USER_ID) REFERENCES USER(ID)
)`;

const createIngredientTable = `
CREATE TABLE IF NOT EXISTS INGREDIENT (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    PRICE REAL NOT NULL
)`;

const createCartItemTable = `
CREATE TABLE IF NOT EXISTS CART_ITEM (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INT NOT NULL,
    SANDWICH_ID INT NOT NULL,
    QUANTITY INT NOT NULL,
    PRICE REAL NOT NULL,
    FOREIGN KEY (USER_ID) REFERENCES USER(ID),
    FOREIGN KEY (SANDWICH_ID) REFERENCES SANDWICH(ID)
)`;

const createOrderItemTable = `
CREATE TABLE IF NOT EXISTS ORDER_ITEM (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INT NOT NULL,
    SANDWICH_ID INT NOT NULL,
    QUANTITY INT NOT NULL,
    PRICE REAL NOT NULL,
    TOTAL_PRICE REAL NOT NULL,
    FOREIGN KEY (USER_ID) REFERENCES USER(ID),
    FOREIGN KEY (SANDWICH_ID) REFERENCES SANDWICH(ID)
)`;

const createFeedbackTable = `
CREATE TABLE IF NOT EXISTS FEEDBACK (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INT NOT NULL,
    ORDER_ITEM_ID INT NOT NULL,
    COMMENT TEXT,
    RATING INT,
    FOREIGN KEY (USER_ID) REFERENCES USER(ID),
    FOREIGN KEY (ORDER_ITEM_ID) REFERENCES ORDER_ITEM(ID)
)`;

// Exporting database and table creation queries
module.exports = {
    db,
    createUserTable,
    createSandwichTable,
    createIngredientTable,
    createCartItemTable,
    createOrderItemTable,
    createFeedbackTable
};
